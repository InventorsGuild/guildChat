<!doctype html>
<html>
  <head>
    <title>Socket.IO Chat</title>
    <style>
	   body {
	       margin: 0;
		   padding: 0;
		   font: 13px Helvetica; 
	   }
	
	   #container { 
		  min-width: 1200px;
		  height: 100%;
		  z-index: 10;
	   }
	   #header { 
	       position: relative;
	       height: 60px; 
		   width: 100%;
	       text-align: center;
		   background: #3B5694; 
		   -webkit-box-shadow: 0 0 5px rgba(0, 0, 0, 0.25);
		  -moz-box-shadow: 0 0 5px rgba(0, 0, 0, 0.25);
		   box-shadow: 0 0 5px rgba(0, 0, 0, 0.25);	
	   }
	   #circle { 
	       left: 60px; 
		   top: 16px; 
	       width: 20px; 
		   height: 20px; 
	       position: absolute;
		   text-align: left; 
		   background: #E60000;
		   -webkit-border-radius: 10px; 
		   -moz-border-radius: 10px; 
		   border-radius: 10px; 
		   border: 2px solid #B20000;		   
	   }
	   #nameBox { 
	       position: relative;
		   vertical-align: top;
	   }
	   #connectText { 
	       padding-bottom: 5px;
		   display: block;
	       color: #FFF;
		   font-size: 95%;
	   }
	   #connectName { 
	        color: #FFF; 
			font-size: 155%;
	   }

	   .noSelect {
		   -webkit-touch-callout: none;
		   -webkit-user-select: none;
		   -khtml-user-select: none;
		   -moz-user-select: none;
		   -ms-user-select: none;
		   user-select: none;
	   }
	   
	   #moreUL {
		  position: relative;
		  top: -25px;
	      left: 40%;
	      text-align: left;
		  display: inline;
		  margin: 0;
		  padding: 10px 4px 12px 0;
		  list-style: none;
		  -webkit-box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
		  -moz-box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
		  box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);		  
	   }
	   
	   #moreLI {
	       font: bold 12px/18px sans-serif;
		   display: inline-block;
		   margin-right: -4px;
		   position: relative;
		   padding: 10px 40px;
		   background: #fff;
		   cursor: pointer;
		   -webkit-transition: all 0.2s;
		   -moz-transition: all 0.2s;
		   -ms-transition: all 0.2s;
		   -o-transition: all 0.2s;
		   transition: all 0.2s;
		   
		   border-radius: 5px 5px 0px 0px;
		   -moz-border-radius: 5px 5px 0px 0px;
		   -webkit-border-radius: 5px 5px 0px 0px;
	   }
	   
	   #moreLI:hover {
		   background: #eee;      
	   }	   
	   #moreLI:active {
	       background: #ccc;
	   }
       
	   
	   #dropDown {
	      text-align: left;
		  display: inline;
		  margin: 0;
		  padding: 10px 4px 12px 0;
		  list-style: none;
		  
		  position: absolute;
		  top: 29px;
		  left: -151px;
		  width: 150px;
		  -webkit-box-shadow: none;
		  -moz-box-shadow: none;
		  box-shadow: none;
		  display: none;	
		  
		  -webkit-transiton: opacity 0.5s;
		  -moz-transition: opacity 0.5s;
		  -ms-transition: opacity 0.5s;
		  -o-transition: opacity 0.5s;
		  -transition: opacity 0.5s;
		  z-index: 40;
	   }
	   
	   #moreDropDown {
	      cursor: default;
	      width: 260px;
		  height: 380px;
	      background: #8196C8;
		  display: block;
		  -webkit-box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
		  -moz-box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
		  box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
	   }
	   
	   #onlineContainer { 
	      vertical-align: top; 
		  display: inline-box;
	      padding-top: 15px;
	      text-align: center;
	   }
	   
	   #onlineUsersSpan {
	       color: #fff;
		   font-size: 125%; 
		   font-weight: bold;
	   }
	   
	   #onlineUsersScrollable {
	       position: relative;
	       height: 260px;
		   width: 190px;		   
	       overflow-y: auto;
		   overflow-x: hidden;
	       margin-top: 3px; 		
		   left: 12.5%;
		   background: #fff;
		   -webkit-box-shadow: 0 0 3px rgba(0, 0, 0, 0.15);
		   -moz-box-shadow: 0 0 3px rgba(0, 0, 0, 0.15);
		   box-shadow: 0 0 3px rgba(0, 0, 0, 0.15);		   
	   }
	   
	   #onlineUsers {
	       height: 100%;
	       background: #fff;
		   list-style-type: none; 
		   display: block;
	   }
	   
	   #onlineUsers li {
	      position: relative;
		  width: 178px;
	      padding: 3px 6px;
		  left: -40px;
		  text-align: left;
		  font-size: 95%;
		  font-style: default;
	   }
	   #onlineUsers li:nth-child(odd) { 
	      background: #eee; 
	   }
	   
	   #settingsButton {
	       font: bold 12px/18px sans-serif;
		   display: inline-block;
		   margin-right: -4px;
		   position: relative;
		   padding: 10px 20px;
		   background: #fff;
		   cursor: pointer;	    
		   border: 0;
		   border-radius: 5px; 
		   -moz-border-radius: 5px; 
		   -webkit-border-radius: 5px;
		   -webkit-box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
		   -moz-box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
		   box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);	
		   
		   position:relative;
		   left: 130px;
		   top: 20px;
	   }
	   
	   #settingsButton:hover {
		   background: #eee;      
	   }	   
	   #settingsButton:active {
	       background: #ccc;
	   }
	   
	   #shadow {
	       background: #000; 
		   position: fixed; 
		   left: 0; 
		   right: 0; 
		   width: 100%; 
		   height: 100%; 
		   z-index: 42; 
		   display: none; 
		   opacity: 0.7; 
		   filter:progid:DXImageTransform.Microsoft.BasicImage(opacity=.7);
	   }
	   
	   #settingsBox {
	      position: absolute;
	      background: #fff; 
		  left: 50%; 
		  top: 50%; 
		  height: 300px; 
		  width: 400px; 
		  margin-top: -150px; 
		  margin-left: -200px; 
		  display: none; 
		  z-index: 44; 	

		 -webkit-box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
		 -moz-box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
		  box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);			  
	   }
	   
	   #settingsContainer {
	      vertical-align: top; 
		  text-align: center; 
		  z-index: 45;
		  display: block;
	   }
	   
	   #settingsHeader {
	      position: relative;
		  width: 100%;
		  background: #3B5694;
		  padding-top: 10px; 
		  padding-bottom: 10px;
	   }
	   
	   #settingsLabel {
	       color: #fff;
	       font-size: 150%;
	   }
	   
	   #nameChangeContainer {
	      padding-top: 50px; 
	      vertical-align: top; 
	      display: inline-block;
	   }
	   
	   #displayNameSpan {
	       font-size: 125%;
	   }
	   
	   #changeNameInput {
	      padding: 5px; 
		  width: 70%; 
		  margin-right: 2%; 
		  margin-left: 3%;
		  -webkit-border-radius: 5px;
		  -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.15);
		  -moz-box-shadow: 0 0 1px rgba(0, 0, 0, 0.15);
		  box-shadow: 0 0 1px rgba(0, 0, 0, 0.15);			  
	   }
	   
	   #changeNameButton {
	       font: bold 12px/18px sans-serif;
		   display: inline-block;
		   margin-right: -4px;
		   position: relative;
		   padding: 5px 10px;
		   background: #fff;
		   cursor: pointer;	    
		   border: 0;
		   border-radius: 5px; 
		   -moz-border-radius: 5px; 
		   -webkit-border-radius: 5px;
		   -webkit-box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
		   -moz-box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
		   box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);	   
	   }
	   
	   #changeNameButton:hover {
	      background: #eee;  
	   }
	   
	   #changeNameButton:active {
	      background: #ccc;  
	   }
	   
	   #messagesContainer {
	       position: absolute;
		   width: 100%;
		   overflow-y: auto;	
		   bottom: 45px;
		   top: 60px;
		   z-index: 5;
	   }
	   
	   #messages {	   
   
	       list-style-type: none; 
		   margin: 0; 
		   padding: 0; 
		   display: block;
		   z-index: 5;
	   }
	   
	   .msg { 
	       padding: 5px 10px; 
	   }
       .msg:nth-of-type(even) { 
	       background: #eee; 
		   z-index: 5;
	   }
	   .msg label {
	       color: #414163; 
		   font-weight: bold; 
		   padding-right: 25px; 
	   }
	   .msg span { 
	       color: #000; 
	   }
	   
	   .userLabel { 
	      padding-left: 80%; 
		  font-size: 10x; 
		  font-style: italic; 
	   }
	   
	   #messageFormContainer {
	       position: absolute;
		   bottom: 0;
	       width: 100%;
		   min-width: 1200px;
		   border-top: 1px solid #444;		   
	   }
	   
	   #messageForm {
	       position: relative;
	       background: #233F7E;  
		   padding: 3px;
	   }
	   
	   #messageInput {
	       width: 89%;
		   padding: 10px;
           margin-right: .5%; 
		   margin-left: 0.5%;		   
	   }
	   
	   #sendButton {
	       width: 8%;	   
	   	   font: bold 12px/18px sans-serif;
		   display: inline-block;
		   margin-right: -4px;
		   position: relative;
		   padding: 8px 10px;
		   background: #b3e7f1;
		   cursor: pointer;	    
		   border: 0;
		   border-radius: 5px; 
		   -moz-border-radius: 5px; 
		   -webkit-border-radius: 5px;
		   -webkit-box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
		   -moz-box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
		   box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);	 
	   }
	   
	   #sendButton:hover {
	      background: #a0e1ed;
	   }
	   #sendButton:active {
	      background: #8ddbea;
	   }	   
	</style>
  </head>
  <body>
    <div id="container">
	  <div id="shadow"></div> 	
      <div id="header">
	    <div id="circle"></div>
		<div id="nameBox">
		  <label id="connectText" class="noSelect">Connected as</label>
		  <label id="connectName" class="noSelect"></label>
		</div>	
		<ul id="moreUL">
		  <li id="moreLI" class="noSelect">
		    More
			<ul id="dropDown">
			  <div id="moreDropDown">
				 <div id="onlineContainer">
				   <span id="onlineUsersSpan" class="noSelect">Online Users</span>
				   <div id="onlineUsersScrollable">
				     <ul id="onlineUsers"></ul>
				   </div>
				 </div>
				<button id="settingsButton">Settings</button>
			  </div>
			</ul>
		  </li>
		</ul>
	  </div>
	  
	  <div id="settingsBox">
	    <div id="settingsContainer">
		   <div id="settingsHeader">
		     <label id="settingsLabel" class="noSelect">Settings</label>
		   </div>
		   <div id="nameChangeContainer">
		     <span id="displayNameSpan" class="noSelect">Display Name</span>
		     <input id="changeNameInput" autofocus autocomplete="off" /><button id="changeNameButton" class="regularButton">Ok</button>
		   </div>
		</div>
	  </div>	  
	  

   
      <div id="messageFormContainer">
      <form id="messageForm" action="">
        <input id="messageInput" autofocus autocomplete="off" /><button id="sendButton">Send</button>
      </form>	 
	  </div>
	</div>
	<div id="messagesContainer">
      <ul id="messages"></ul>
	</div>

	
	<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
	<script type="text/javascript" src="/jquery/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="/jquery/jquery-ui-1.7.2.custom.min.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
	<script type="text/javascript" language="javascript">
	    
		var socket = io();
		var clicks = 0;
		var darken = false;
	    var name = "____";
		var messagesContainer = document.getElementById('messagesContainer');
		var connected = false;
	
		//When you submit a message
		$('#messageForm').submit(function() {
			if($('#messageInput').val() != '') {
				socket.emit('chat message', '<li class="msg"><label>' + name + ':</label><span>' + $('#messageInput').val() + '</span></li>');		
				$('#messages').append($('<li class="msg">').append('<label>' + name + ':</label><span>' + $('#messageInput').val() + '</span>'));
				$('#messageInput').val('');
				messagesContainer.scrollTop = messagesContainer.scrollHeight;		    
			}
			return false;
		}); 
	
	    //Toggle the dropdown menu to display the online users/settings button
	    $('#moreLI').click(function() {
	        $('#dropDown').toggle();
	    });
	  
	    //Open the settings box
	    $('#settingsButton').click(function() {    
   	        $('#shadow').toggle();  
            $('#settingsBox').toggle();	
			$('#changeNameInput').focus();	 
			$('#changeNameInput').val(name);
			clicks = 0;
			darken = true;
		});
	  
	    //When you change your name and click Ok
		$('#changeNameButton').click(function() {
			name = $('#changeNameInput').val();
			$('#connectName').text(name);
			setCookie("name", name, 1);
		  
			socket.emit('new display name', name);
		  
			$('#shadow').toggle();  
			$('#settingsBox').toggle();
			$('#messageInput').focus();	 
			darken = false;		  
		});
		
		//Allows you to press enter on the change name box and it will click ok
		$('#changeNameInput').keypress(function(e) {
			if(e.which == 13)
				$('#changeNameButton').click();
		});
	  
	    //Remove the shadow when you click anywhere besides the settingsBox
	    $(document).on('click', function(event) {
			if(!$(event.target).closest('#settingsBox').length) {
				clicks++;
				if((clicks > 1) && (darken == true)) {
					$('#shadow').toggle();  
					$('#settingsBox').toggle();
					$('#messageInput').focus();	 
					darken = false;	
				}
			}
		});
				
		//On page ready, set up name variable and connected users
		$( document ).ready(function() {
		    $('#connectText').text('Not connected');
			$('#connectName').text('____');
		});
	  
	  	//Handle the events needed for when you make connection with the server
		function connectionStart() {
		    $('#circle').css('background', '#00e500');
			$('#circle').css('border', '2px solid #00b200');
		    $('#connectText').text('Connected as');
			var tempName = getCookie("name");		  
			if(tempName != "") {
				name = tempName;
				socket.emit('have display name', name);
				$('#connectName').text(name);		
				socket.emit('need all connections', "pls");
			}	 
			else
				socket.emit('need guest name', "");		    
		}
		
		//Handle the events for if the server goes down
		function serverDisconnect() {
		    $('#circle').css('background', '#E60000');
			$('#circle').css('border', '2px solid #B20000');
		    $('#connectText').text('Not connected');
			$('#connectName').text('____');		    
		}
		  
		//------------Handle all socket identifiers ---------------------------------------------------
		//For handling the startup of a connection to the server
		socket.on('connect', function() {
		   connected = true;
		   connectionStart();
		});
		
		//For handling the server disconnecting
		socket.on('disconnect', function() {
		    connected = false;
			serverDisconnect();
		});
		
		//For gathering chat messages and displayin them
		socket.on('chat message', function(msg){
			$('#messages').append(msg);
			messagesContainer.scrollTop = messagesContainer.scrollHeight;
		});	
	  
		//For setting your name as a guest with a unique number (you haven't configured a name yet)
		socket.on('guest name', function(gName) {
			name = gName;
			$('#connectName').text(name);
			socket.emit('need all connections', "pls");
		});
	  
		//For getting newly connected users and appending their name to the online users list
		socket.on('connected user', function(name) {
			$('#onlineUsers').append($('<li>').text(name));
			$('#messages').append('<label class="userLabel">' + name + ' has connected<br></label>');
		});
	  
		//For getting all the connected users at once to append to the online users list
		socket.on('all connections', function(names) {
			$('#onlineUsers').empty();
			for(var i=0; i<names.length; i++) {
				$('#onlineUsers').append($('<li>').text(names[i].Name));
			}
		});
	  
	    //For displaying to the chat when a user disconnects
		socket.on('disconnected user', function(name) {
			$('#messages').append('<label class="userLabel">' + name + ' has disconnected<br></label>');
		});
		//---------------------------------------------------------------------------------------------
		
		//Functions for cookies for storing your name  ------------------------------------------------
		function setCookie(cname, cvalue, exdays) {
			var d = new Date();
			d.setTime(d.getTime() + (exdays*24*60*60*1000));
			var expires = "expires="+d.toUTCString();
			document.cookie = cname + "=" + cvalue + "; " + expires;
		} 
	  
		function getCookie(cname) {
			var tname = cname + "=";
			var ca = document.cookie.split(';');
			for(var i=0; i<ca.length; i++) {
				var c = ca[i];
				while (c.charAt(0)==' ') c = c.substring(1);
				if (c.indexOf(tname) == 0) return c.substring(tname.length, c.length);
			}
			return "";
		}
		//---------------------------------------------------------------------------------------------	  
	</script>
  </body>
</html>